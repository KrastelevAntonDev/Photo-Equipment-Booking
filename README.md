# Photo-Equipment-Booking

Backend API –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–æ—Ç–æ—Å—Ç—É–¥–∏–π –∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –Ω–∞ Node.js, Express, MongoDB.

## –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- üîê –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (JWT)
- üìÖ –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—É–¥–∏–π –∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
- üí≥ –û–Ω–ª–∞–π–Ω-–æ–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ –Æ–ö–∞—Å—Å–∞ (–ø–æ–ª–Ω–∞—è/—á–∞—Å—Ç–∏—á–Ω–∞—è)
- üéüÔ∏è –ü—Ä–æ–º–æ–∫–æ–¥—ã –∏ —Å–∫–∏–¥–∫–∏
- üí∞ –ë–∞–ª–∞–Ω—Å –∏ –±–æ–Ω—É—Å–Ω—ã–µ –±–∞–ª–ª—ã
- üì± SMS/Viber —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
- üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- üè¢ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—É–¥–∏—è–º–∏ –∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ–º
- üìä –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º–∏
- üí∏ –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–µ–π —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ —Å–∫–∏–¥–∫–∞–º–∏
- üßæ **–§–∏—Å–∫–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ñ–ª–∞–π–Ω-–ø–ª–∞—Ç–µ–∂–µ–π —á–µ—Ä–µ–∑ –ê–¢–û–õ**
- üéÅ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞–º–∏
- üìß –û—Ç–ø—Ä–∞–≤–∫–∞ SMS/Omni —Å–æ–æ–±—â–µ–Ω–∏–π

## –ù–æ–≤–æ–µ: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ê–¢–û–õ

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ê–¢–û–õ –û–Ω–ª–∞–π–Ω –¥–ª—è —Ñ–∏—Å–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–ª–∞—Ç–µ–∂–µ–π –Ω–∞ –º–µ—Å—Ç–µ (–Ω–∞–ª–∏—á–Ω—ã–µ/–∫–∞—Ä—Ç–∞).

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —á–µ–∫–æ–≤ –≤ –§–ù–°
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Ñ–∏—Å–∫–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–Ω–æ–º–µ—Ä —á–µ–∫–∞, –§–ù, —Ñ–∏—Å–∫–∞–ª—å–Ω—ã–π –ø—Ä–∏–∑–Ω–∞–∫)
- –°—Å—ã–ª–∫–∏ –Ω–∞ —á–µ–∫–∏ –≤ –û–§–î –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å polling —Å—Ç–∞—Ç—É—Å–∞
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Ñ–∏—Å–∫–∞–ª–∏–∑–∞—Ü–∏–∏

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- [–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –ê–¢–û–õ](docs/atol-integration.md)
- [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è API](docs/atol-examples.md)

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Node.js** + **Express** - Backend framework
- **TypeScript** - Type-safe development
- **MongoDB** - Document database
- **JWT** - Authentication
- **–Æ–ö–∞—Å—Å–∞ API** - Online payments
- **–ê–¢–û–õ –û–Ω–ª–∞–π–Ω API** - Fiscal receipts
- **P1SMS API** - SMS/Viber/VK notifications
- **Swagger/OpenAPI** - API documentation

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)

```env
# Server
NODE_ENV=development
PORT=3000
PUBLIC_SITE_URL=https://picassostudio.ru

# MongoDB
MONGODB_URI=mongodb://localhost
MONGODB_PORT=27017
MONGODB_NAME=photo_booking

# JWT
JWT_SECRET=your_jwt_secret_key

# –Æ–ö–∞—Å—Å–∞
SHOP_ID=your_shop_id
SECRET_KEY=your_secret_key

# –ê–¢–û–õ
ATOL_LOGIN=your_atol_login
ATOL_PASSWORD=your_atol_password
ATOL_GROUP_CODE=your_group_code
ATOL_INN=1234567890
ATOL_PAYMENT_ADDRESS=https://your-site.ru
ATOL_COMPANY_EMAIL=info@your-site.ru
ATOL_BASE_URL=https://online.atol.ru

# P1SMS
P1SMS_API_KEY=your_p1sms_api_key
P1SMS_BASE_URL=https://admin.p1sms.ru
```

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pnpm install

# –ö–æ–º–ø–∏–ª—è—Ü–∏—è TypeScript
pnpm build

# –ó–∞–ø—É—Å–∫ –≤ production
pnpm start

# –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å hot reload
pnpm dev
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
src/
‚îú‚îÄ‚îÄ app.ts                          # Express app setup
‚îú‚îÄ‚îÄ config/                         # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (DB, env, swagger)
‚îú‚îÄ‚îÄ infrastructure/external/        # –í–Ω–µ—à–Ω–∏–µ API –∫–ª–∏–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ yookassa/                   # –Æ–ö–∞—Å—Å–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ atol/                       # –ê–¢–û–õ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ modules/                        # Feature modules
‚îÇ   ‚îú‚îÄ‚îÄ auth/                       # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ atol/                       # üÜï –§–∏—Å–∫–∞–ª–∏–∑–∞—Ü–∏—è –ê–¢–û–õ
‚îÇ   ‚îú‚îÄ‚îÄ bookings/                   # –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ equipment/                  # –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ forms/                      # –§–æ—Ä–º—ã –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
‚îÇ   ‚îú‚îÄ‚îÄ payments/                   # –ü–ª–∞—Ç–µ–∂–∏ (–Æ–ö–∞—Å—Å–∞)
‚îÇ   ‚îú‚îÄ‚îÄ promocodes/                 # –ü—Ä–æ–º–æ–∫–æ–¥—ã
‚îÇ   ‚îú‚îÄ‚îÄ rooms/                      # –°—Ç—É–¥–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ sms/                        # SMS/Omni —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ subscriptions/              # –ü–æ–¥–ø–∏—Å–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ uploads/                    # –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ users/                      # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
‚îÇ   ‚îî‚îÄ‚îÄ webhooks/                   # –í–µ–±—Ö—É–∫–∏ (–Æ–ö–∞—Å—Å–∞, P1SMS)
‚îú‚îÄ‚îÄ routes/                         # Centralized routing
‚îú‚îÄ‚îÄ shared/                         # Shared utilities
‚îî‚îÄ‚îÄ public/uploads/                 # User-uploaded files
```

## API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –ê–¢–û–õ (–§–∏—Å–∫–∞–ª–∏–∑–∞—Ü–∏—è) üÜï

```
POST   /api/admin/atol/receipts                 # –°–æ–∑–¥–∞—Ç—å —Ñ–∏—Å–∫–∞–ª—å–Ω—ã–π —á–µ–∫
GET    /api/admin/atol/receipts/:id             # –ü–æ–ª—É—á–∏—Ç—å —á–µ–∫ –ø–æ ID
GET    /api/admin/atol/receipts/booking/:id     # –ß–µ–∫–∏ –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
POST   /api/admin/atol/receipts/:id/refresh     # –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å —á–µ–∫–∞
```

### –ü—Ä–æ–º–æ–∫–æ–¥—ã

```
POST   /api/admin/promocodes                    # –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥
GET    /api/admin/promocodes                    # –°–ø–∏—Å–æ–∫ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
GET    /api/admin/promocodes/:id                # –ü—Ä–æ–º–æ–∫–æ–¥ –ø–æ ID
PATCH  /api/admin/promocodes/:id                # –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥
DELETE /api/admin/promocodes/:id                # –£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥
POST   /api/promocodes/validate                 # –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞
```

### –ü–ª–∞—Ç–µ–∂–∏

```
POST   /api/payments                            # –°–æ–∑–¥–∞—Ç—å –ø–ª–∞—Ç—ë–∂
POST   /api/admin/payments                      # –ê–¥–º–∏–Ω: —Å–æ–∑–¥–∞—Ç—å —Å –∫–∞—Å—Ç–æ–º–Ω–æ–π —Å–∫–∏–¥–∫–æ–π
POST   /api/webhooks/yookassa                   # –í–µ–±—Ö—É–∫ –æ—Ç –Æ–ö–∞—Å—Å—ã
```

### –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

```
POST   /api/bookings                            # –°–æ–∑–¥–∞—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (—Å –ø—Ä–æ–º–æ–∫–æ–¥–æ–º)
GET    /api/bookings                            # –°–ø–∏—Å–æ–∫ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
GET    /api/admin/bookings                      # –ê–¥–º–∏–Ω: –≤—Å–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
PATCH  /api/admin/bookings/:id                  # –ê–¥–º–∏–Ω: –æ–±–Ω–æ–≤–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
DELETE /api/admin/bookings/:id                  # –ê–¥–º–∏–Ω: —É–¥–∞–ª–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
```

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

```
POST   /api/auth/register                       # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
POST   /api/auth/login                          # –í—Ö–æ–¥
GET    /api/users/me                            # –ü—Ä–æ—Ñ–∏–ª—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
GET    /api/admin/users                         # –ê–¥–º–∏–Ω: —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
PUT    /api/admin/users/:id                     # –ê–¥–º–∏–Ω: –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```

**–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `http://localhost:3000/api-docs` (Swagger UI)

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [–ü—Ä–æ–º–æ–∫–æ–¥—ã](docs/promocodes.md)
- [–ê–¥–º–∏–Ω—Å–∫–∏–µ —Å–∫–∏–¥–∫–∏](docs/admin-discounts.md)
- [–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π](docs/admin-update-users.md)
- [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ê–¢–û–õ](docs/atol-integration.md) üÜï
- [–ü—Ä–∏–º–µ—Ä—ã –ê–¢–û–õ API](docs/atol-examples.md) üÜï
- [SMS API](docs/smsApi.md)

## YML-—Ñ–∏–¥—ã

- `GET /yml-feed` ‚Äî –µ–¥–∏–Ω—ã–π —Ñ–∏–¥ –¥–ª—è —Å—Ç—É–¥–∏–π –∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `?segment=rooms|equipment|all` –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏).
- `GET /yml-feed/studios` ‚Äî —Ñ–∏–¥ —Ç–æ–ª—å–∫–æ –ø–æ —Å—Ç—É–¥–∏—è–º (–∫–∞—Ç–∞–ª–æ–≥–∏ –∏ –ø–æ–¥–∫–∞—Ç–∞–ª–æ–≥–∏ —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏).
- `GET /yml-feed/equipment` ‚Äî —Ñ–∏–¥ —Ç–æ–ª—å–∫–æ –ø–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—é.

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:

- `site=https://picassostudio.ru` ‚Äî –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –¥–æ–º–µ–Ω –∫–∞—Ä—Ç–æ—á–µ–∫ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `PUBLIC_SITE_URL`).
- `collections=0` ‚Äî –æ—Ç–∫–ª—é—á–∏—Ç—å –±–ª–æ–∫ `<collections>` (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ Direct –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–∞—Ç–∞–ª–æ–≥–∏).
- `limit=5000` ‚Äî –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ñ—Ñ–µ—Ä–æ–≤ –≤ –≤—ã–¥–∞—á–µ.

–í HTTP-–∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö –æ—Ç–≤–µ—Ç–∞ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è —Å–ª—É–∂–µ–±–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:

- `X-Feed-Offers` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –æ—Ñ—Ñ–µ—Ä–æ–≤.
- `X-Feed-Collections` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–∞—Ç–∞–ª–æ–≥–æ–≤.

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT